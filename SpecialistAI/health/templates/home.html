{% extends 'base.html' %}
<!-- Load ststic files -->
{% load staticfiles %}
<!-- Sets the title for the page -->
{% block title %}Home{% endblock %}

<!-- Block for loading extra content, I.e. page specific css or javascript -->
{% block extra %}
    <link rel="stylesheet" href="{% static 'messages.css' %}">
    <link rel="stylesheet" href="{% static 'multiselect.css' %}">
    <script src="{% static 'multiselect.js' %}"></script>

{% endblock %}

<!-- Loads all page contents within the content block -->
{% block content %}

<!-- Checks to see if the curretn user is authenticated -->
{% if user.is_authenticated %}
{% elif navbar != 'login' %}
    <ul class="nav navbar-nav navbar-right">
        <li><a href="{% url 'health:login' %}"><i class="fa fa-sign-in"></i>&nbsp;Sign In</a></li>
    </ul>
{% endif %}

<div class="container body">
    <div class="main_container">
        <div class="col-md-3 left_col">
            <div class="left_col scroll-view">
                <div class="navbar nav_title" style="border: 0;">
                    <a href="index.html" class="site_title">
                        <span>Specialist AI</span></a>
                </div>

                <div class="clearfix"></div>

                <!-- menu profile quick info -->
                <div class="profile clearfix">
                    <div class="profile_info">
                        <span></span>

                        <!-- Implement account checks -->
                        <!-- If the user is a patient -->
                        {% if user.is_patient %}
                            Patient {% include 'user_link.html' %}
                        {% endif %}
                        <!-- If the user is a doctor -->
                        {% if user.is_doctor %}
                            Dr {% include 'user_link.html' %}
                        {% endif %}
                        <!-- If the user is a nurse -->
                        {% if user.is_nurse %}
                            Nurse {% include 'user_link.html' %}
                        {% endif %}
                        <!-- If the user is a admin -->
                        {% if user.is_superuser %}
                            Admin {% include 'user_link.html' %}
                        {% endif %}
                        
                    </div>
                </div>
                <!-- /menu profile quick info -->

                <br />

                <!-- sidebar menu -->
                <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
                    <div class="menu_section">
                        <h3>General</h3>
                        <ul class="nav side-menu">
                            <!-- Includes the navbar -->
                            {% include 'navbar.html' %}
                        </ul>
                    </div>
                </div>
                <!-- /sidebar menu -->

                <!-- /menu footer buttons -->
                <div class="sidebar-footer hidden-small">
                    <a data-toggle="tooltip" data-placement="top" title="Settings">
                        <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
                    </a>
                    <a data-toggle="tooltip" data-placement="top" title="Profile">
                        <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                    </a>
                    <a data-toggle="tooltip" data-placement="top" title="Lock">
                        <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
                    </a>
                    <!-- Sets the url for the logout functionality -->
                    <a data-toggle="tooltip" data-placement="top" title="Logout" href="{% url 'health:logout' %}">
                        <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
                    </a>
                </div>
                <!-- /menu footer buttons -->
            </div>
        </div>

        <!-- top navigation -->
        <div class="top_nav">
            <div class="nav_menu">
                
                <nav class="nav navbar-nav">
                    <ul class=" navbar-right">
                        <li class="nav-item dropdown open" style="padding-left: 15px;">
                            <a href="javascript:;" class="user-profile dropdown-toggle" aria-haspopup="true"
                                id="navbarDropdown" data-toggle="dropdown" aria-expanded="false">
                                
                                
                            </a>
                            <div class="dropdown-menu dropdown-usermenu pull-right"
                                aria-labelledby="navbarDropdown">
                                <!-- Sets the url for the logout functionality -->
                                <a class="dropdown-item" href="{% url 'health:logout' %}">
                                    <i class="fa fa-sign-out pull-right"></i>Log Out</a>
                            </div>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main" style="min-height: 912px;">
            <!-- Checks to see if the user is a doctor -->
            {% if user.is_doctor %}
            <div class="row">
                <div class="col-md-12 col-sm-12">

                    <!-- CHAT LIST START -->
                    <div class="col-md-4 col-sm-4">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>Chats</h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li>
                                        <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="dashboard-widget-content">
                                <!-- If the groups -->
                                {% if groups %}
                                    <!-- For loop to iterate through all groups, I.e. conversations -->
                                    {% for group in groups %}
                                    <!-- Sets the href to the primary key, navigate to the conversation -->
                                    <a href="{% url 'health:conversation' group.pk %}">
                                        <div class="mail_list">
                                            <div class="right">
                                                <!-- If the group has a latest mesage -->
                                                {% if group.latest_message %}
                                                    <!-- Retrieves/sets the combined names of sender/reciever and the date -->
                                                    <h3>{{ group.combined_names }} <small>{{ group.latest_message.date }}</small></h3>
                                                    <p></p>  
                                                {% endif %}
                                                    <!-- Retrieves the group name -->
                                                    <p><em><strong>{{ group.name }}</strong></em></p>
                                                
                                                <!-- Checks if the user has an unread message -->
                                                {% if group.has_unread %}
                                                <div class="left">
                                                    <i class="fa fa-circle"></i> <i class="fa fa-edit"></i>
                                                </div>
                                                {% endif %}
                                                
                                                <div class="indent">
                                                    <!-- If the user has a latest message -->
                                                    {% if group.latest_message %}
                                                        <!-- 
                                                            Retrieve the sender of a message and if it is the current account, then display you
                                                            and display a preview of the body of the message
                                                         -->
                                                        <span class="text-preview"><em>{% if group.latest_message.sender == user %}You: {% endif %}<p>{{ group.latest_message.preview_text }}</p></em></span>
                                                    {% else %}
                                                        <!-- If not messages exist, then display this -->
                                                        <span class="text-preview"><em>No Messages</em></span>
                                                    {% endif %}
                                                </div>

                                            </div>
                                        </div>
                                    </a>
                                    {% endfor %}
                                {% else %}
                                    <!-- If not messages exist, then display this -->
                                    <h2 style="text-align: center">No messages.</h2>
                                {% endif %}
                                </div>
                            </div>
                            <!-- Create a COMPOSE button for creating a new conversation/message -->
                            <button id="compose" class="btn btn-sm btn-success btn-block" data-toggle="modal" data-target="#send">COMPOSE</button>

                            {% include 'error.html' %}
                            
                        </div>
                    </div>
                    <!-- CHATS LIST END -->

                    <div class="row">

                        <!-- SCHEDULE START -->
                        <div class="col-md-6 col-sm-6">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>Schedule <small>For full, check Your Schedule</small></h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li>
                                            <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <div class="dashboard-widget-content">
                                        <!-- Include the error page, incase of an error -->
                                        {% include 'error.html' %}
                                        <!-- If there are shcedule appointment in the future -->
                                        {% if schedule_future %}
                                            <table class="table table-bordered table-striped">
                                                <!-- Include the user link page -->
                                                <legend>Upcoming appointments for {% include 'user_link.html' %}</legend>
                                                <!-- 
                                                    Include the appointment table for displaying all appointments
                                                    and set editable to false
                                                 -->
                                                {% include 'appointment_table.html' with schedule=schedule_future editable=False %}
                                            </table>
                                        {% else %}
                                            <!-- If not then display there are no appointment -->
                                            <h2 class="text-center">No upcoming appointments.</h2>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- SHECULE END -->
    
                        <!-- PRESCRIPTIONS START -->
                        <div class="col-md-6 col-sm-6">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>Prescriptions <small>For all, check Your prescriptions</small></h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li>
                                            <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <div class="dashboard-widget-content">
                                        <!-- Include the error page, incase of an error -->
                                        {% include 'error.html' %}
                                        <!-- If there are users -->
                                        {% if user.active_patients %}
                                            <div class="modal fade" id="edit" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <!-- If logged in user can ad a prescription, I.e. doctor -->
                                                {% if logged_in_user.can_add_prescription %}
                                                    <!-- A for loop to iterate through all active patients -->
                                                    {% for user in user.active_patients %}
                                                        <!-- If the user has any active prescriptions -->
                                                        {% if user.active_prescriptions %}
                                                            <table class="table table-bordered table-striped">
                                                                <!-- Include the user link page -->
                                                                <legend>Prescriptions for {% include 'user_link.html' %}</legend>
                                                                <thead>
                                                                <tr>
                                                                    <th>Dosage</th>
                                                                    <th>Name</th>
                                                                    <th>Directions</th>
                                                                </tr>
                                                                </thead>
                                                                <tbody>
                                                                <!-- For loop to iterate through all active prescriptions -->
                                                                {% for prescription in user.active_prescriptions %}
                                                                    <tr>
                                                                        <!-- Display the medications dosage -->
                                                                        <td>{{ prescription.dosage }}</td>
                                                                        <!-- Display the medications name -->
                                                                        <td>{{ prescription.name }}</td>
                                                                        <!-- Display the medications directions -->
                                                                        <td>{{ prescription.directions }}</td>
                                                                    </tr>
                                                                {% endfor %}
                                                                </tbody>
                                                            </table>
                                                        {% else %}
                                                            <div class="text-center">
                                                                <!-- If no prescriptions are available, then display it and the users name -->
                                                                <h2> No prescriptions for {% include 'user_link.html' %}</h2>
                                                            </div>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                            </div>
                                        {% else %}
                                        <!-- If no prescriptions then dispaly -->
                                            <h2 class="text-center"> No active prescriptions. </h2>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- PRESCRIPTIONS END -->

                    <div class="x_panel">
                        <div class="x_title">
                            <h2>Current Patients<small>records</small></h2>
                            <ul class="nav navbar-right panel_toolbox">
                                <li>
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                </li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="card-box table-responsive">
                                        <table id="datatable-responsive"
                                            class="table table-striped table-bordered dt-responsive nowrap"
                                            cellspacing="0" width="100%">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>First Name</th>
                                                    <th>Surame</th>
                                                    <th>User Full Name</th>
                                                    <th>D.O.B</th>
                                                    <th>Sex</th>
                                                    <th>Landline</th>
                                                    <th>E-mail</th>
                                                    <th>Diagnosed</th>
                                                    <th>Data Acquisition</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- For loop to iterate through all active and current patients -->
                                                {% for patient in user.active_patients %}
                                                <tr>
                                                    <!-- Display the users primary key -->
                                                    <td>{{ patient.pk }}</td>
                                                    <!-- Display the users first name -->
                                                    <td>{{ patient.first_name }}</td>
                                                    <!-- Display the users last name -->
                                                    <td>{{ patient.last_name }}</td>
                                                    <!-- Display the users full name as a link to the medical information page for the user -->
                                                    <td><a href="{% url 'health:medical_information' patient.pk %}">{{ patient.get_full_name }}</a></td>
                                                    <!-- Display the users date of birth -->
                                                    <td>{{ patient.date_of_birth.day}}/{{ patient.date_of_birth.month}}/{{ patient.date_of_birth.year}}</td>
                                                    <!-- Display the users sex -->
                                                    <td>{{ patient.medical_information.sex }}</td>
                                                    <!-- Display the users phone number -->
                                                    <td>{{ patient.phone_number }}</td>
                                                    <!-- Display the users email -->
                                                    <td>{{ patient.email }}</td>
                                                    <!-- Display the users diagnoses status -->
                                                    <td>YES</td>
                                                    <!-- Display wether the user has documents available -->
                                                    <td><a href="{% url 'health:media_gallery' patient.pk %}">Upload data</a></td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            <!-- End of doctor section -->

            <!-- Start of patient section -->
            <!-- Check if the current user is a patient -->
            {% if user.is_patient %}
            <div class="row">
                <div class="col-md-12 col-sm-12">

                    <!-- CHAT LIST START -->
                    <div class="col-md-4 col-sm-4">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>Chats</h2>
                                <ul class="nav navbar-right panel_toolbox">
                                    <li>
                                        <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="dashboard-widget-content">
                                <!-- If the groups -->
                                {% if groups %}
                                    <!-- For loop to iterate through all groups, I.e. conversations -->
                                    {% for group in groups %}
                                    <!-- Sets the href to the primary key, navigate to the conversation -->
                                    <a href="{% url 'health:conversation' group.pk %}">
                                        <div class="mail_list">
                                            <div class="right">
                                                <!-- If the group has a latest mesage -->
                                                {% if group.latest_message %}
                                                    <!-- Retrieves/sets the combined names of sender/reciever and the date -->
                                                    <h3>{{ group.combined_names }} <small>{{ group.latest_message.date }}</small></h3>
                                                    <p></p>  
                                                {% endif %}
                                                    <!-- Retrieves the group name -->
                                                    <p><em><strong>{{ group.name }}</strong></em></p>
                                                
                                                <!-- Checks if the user has an unread message -->
                                                {% if group.has_unread %}
                                                <div class="left">
                                                    <i class="fa fa-circle"></i> <i class="fa fa-edit"></i>
                                                </div>
                                                {% endif %}
                                                
                                                <div class="indent">
                                                    <!-- If the user has a latest message -->
                                                    {% if group.latest_message %}
                                                        <!-- 
                                                            Retrieve the sender of a message and if it is the current account, then display you
                                                            and display a preview of the body of the message
                                                         -->
                                                        <span class="text-preview"><em>{% if group.latest_message.sender == user %}You: {% endif %}<p>{{ group.latest_message.preview_text }}</p></em></span>
                                                    {% else %}
                                                        <!-- If not messages exist, then display this -->
                                                        <span class="text-preview"><em>No Messages</em></span>
                                                    {% endif %}
                                                </div>

                                            </div>
                                        </div>
                                    </a>
                                    {% endfor %}
                                {% else %}
                                    <!-- If not messages exist, then display this -->
                                    <h2 style="text-align: center">No messages.</h2>
                                {% endif %}
                                </div>
                            </div>
                            <!-- Create a COMPOSE button for creating a new conversation/message -->
                            <button id="compose" class="btn btn-sm btn-success btn-block" data-toggle="modal" data-target="#send">COMPOSE</button>

                            {% include 'error.html' %}
                            
                        </div>
                    </div>
                    <!-- CHATS LIST END -->

                    <div class="row">

                        <!-- SCHEDULE START -->
                        <div class="col-md-6 col-sm-6">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>Your<small> Schedule</small></h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li>
                                            <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <div class="dashboard-widget-content">
                                        <!-- Include error page, incase of error -->
                                        {% include 'error.html' %}
                                        <!-- If schedule future, I.e. up coming appointments -->
                                        {% if schedule_future %}
                                            <table class="table table-bordered table-striped">
                                                <!-- Include the users link and display appointments for (user) -->
                                                <legend>Upcoming appointments for {% include 'user_link.html' %}</legend>
                                                <!-- 
                                                    Include the appointment table for displaying all appointments
                                                    and set editable to false
                                                 -->
                                                {% include 'appointment_table.html' with schedule=schedule_future editable=False %}
                                            </table>
                                        {% else %}
                                            <!-- If no upcoming appointments -->
                                            <h2 class="text-center">No upcoming appointments.</h2>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- SHECULE END -->
    
                        <!-- PRESCRIPTIONS START -->
                        <div class="col-md-6 col-sm-6">
                            <div class="x_panel">
                                <div class="x_title">
                                    <h2>Your<small> prescriptions</small></h2>
                                    <ul class="nav navbar-right panel_toolbox">
                                        <li>
                                            <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                        </li>
                                    </ul>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="x_content">
                                    <div class="dashboard-widget-content">
                                        <!-- Include error page incase of error -->
                                        {% include 'error.html' %}
                                        <!-- If there is an active patient -->
                                        {% if user.active_patients %}
                                            <div class="modal fade" id="edit" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <!-- For loop to iterate through the active patients -->
                                                {% for user in user.active_patients %}
                                                    <!-- If there are active prescriptions -->
                                                    {% if user.active_prescriptions %}
                                                        <table class="table table-bordered table-striped">
                                                            <legend>Prescriptions for {% include 'user_link.html' %}</legend>
                                                            <thead>
                                                            <tr>
                                                                <th>Dosage</th>
                                                                <th>Name</th>
                                                                <th>Directions</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            <!-- for loop to iterate through the prescriptions which are active -->
                                                            {% for prescription in user.active_prescriptions %}
                                                                <tr>
                                                                    <!-- Return and display the dosage -->
                                                                    <td>{{ prescription.dosage }}</td>
                                                                    <!-- Return and display the name -->
                                                                    <td>{{ prescription.name }}</td>
                                                                    <!-- Return and display the directions -->
                                                                    <td>{{ prescription.directions }}</td>
                                                                </tr>
                                                            {% endfor %}
                                                            </tbody>
                                                        </table>
                                                    {% else %}
                                                        <div class="text-center">
                                                            <!-- If no prescriptions are available, then display it and the users name -->
                                                            <h2> No prescriptions for {% include 'user_link.html' %}</h2>
                                                        </div>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        {% else %}
                                            <!-- If no prescriptions then dispaly -->
                                            <h2 class="text-center"> No active patients in hospital. </h2>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- PRESCRIPTIONS END -->

                    <div class="x_panel">
                        <div class="x_title">
                            <h2>Your <small>records</small></h2>
                            <ul class="nav navbar-right panel_toolbox">
                                <li>
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                </li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="card-box table-responsive">
                                        <table id="datatable-responsive"
                                            class="table table-striped table-bordered dt-responsive nowrap"
                                            cellspacing="0" width="100%">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>First Name</th>
                                                    <th>Surame</th>
                                                    <th>User Full Name</th>
                                                    <th>D.O.B</th>
                                                    <th>Sex</th>
                                                    <th>Landline</th>
                                                    <th>E-mail</th>
                                                    <th>Diagnosed</th>
                                                    <th>Data Available</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- For loop to iterate through all active and current patients -->
                                                {% for patient in user.active_patients %}
                                                    {% if patient.pk == user.pk %}
                                                        <tr>
                                                            <!-- Display the users primary key -->
                                                            <td>{{ patient.pk }}</td>
                                                            <!-- Display the users first name -->
                                                            <td>{{ patient.first_name }}</td>
                                                            <!-- Display the users last name -->
                                                            <td>{{ patient.last_name }}</td>
                                                            <!-- Display the users full name as a link to the medical information page for the user -->
                                                            <td><a href="{% url 'health:medical_information' patient.pk %}">{{ patient.get_full_name }}</a></td>
                                                            <!-- Display the users date of birth -->
                                                            <td>{{ patient.date_of_birth.day}}/{{ patient.date_of_birth.month}}/{{ patient.date_of_birth.year}}</td>
                                                            <!-- Display the users sex -->
                                                            <td>{{ patient.medical_information.sex }}</td>
                                                            <!-- Display the users phone number -->
                                                            <td>{{ patient.phone_number }}</td>
                                                            <!-- Display the users email -->
                                                            <td>{{ patient.email }}</td>
                                                            <!-- Display the users diagnoses status -->
                                                            <td>YES</td>
                                                            <!-- Display wether the user has documents available -->
                                                            <td>YES</td>
                                                        </tr>
                                                    {% endif %}
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            <!-- End of patient section -->

            <!-- Start of admin section -->
            <!-- If the user is an admin -->
            {% if user.is_admin %}
            <div class="row">
                <!-- STATS START -->
                <div class="col-md-6 col-sm-6">
                    <div class="x_panel">
                        <div class="x_title">
                            <!-- Return and display which hospital the stats being displayed belong to -->
                            <h2>Stats <small>for {{ user.hospital.name }}</small></h2>
                            <ul class="nav navbar-right panel_toolbox">
                                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                </li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <ul class="list-group"></ul>
                                <li class="">
                                    <!-- Display the admission stats -->
                                    <strong>{{ stats.stay_count }}</strong> total admission{% if stats.stay_count != 1 %}s{% endif %}
                                    <ul>
                                        <li>
                                            <!-- Display the discharge stats -->
                                            <strong>{{ stats.discharge_count }}</strong> total discharge{% if stats.discharge_count != 1 %}s{% endif %}
                                        </li>
                                        <li>
                                            <!-- Display the average stay stats -->
                                            <strong>{{ stats.average_stay }}</strong> average stay duration
                                        </li>
                                    </ul>
                                    
                                </li>
                                <li class="">
                                    <!-- Display the user count stats -->
                                    <strong>{{ stats.user_count }}</strong> admitted user{% if stats.user_count != 1 %}s{% endif %}
                                    <ul>
                                        <li>
                                            <!-- Display the patient count stats -->
                                            <strong>{{ stats.patient_count }}</strong> patient{% if stats.patient_count != 1 %}s{% endif %}
                                        </li>
                                        <li>
                                            <!-- Display the doctor count stats -->
                                            <strong>{{ stats.doctor_count }}</strong> doctor{% if stats.doctor_count != 1 %}s{% endif %}
                                        </li>
                                        <li>
                                            <!-- Display the nurse count stats -->
                                            <strong>{{ stats.nurse_count }}</strong> nurse{% if stats.nurse_count != 1 %}s{% endif %}
                                        </li>
                                        <li>
                                            <!-- Display the admin count stats -->
                                            <strong>{{ stats.admin_count }}</strong> administrator{% if stats.admin_count != 1 %}s{% endif %}
                                        </li>
                                    </ul>
                                </li>
                                <li class="">
                                    <!-- Display the prescription count stats -->
                                    <strong>{{ stats.prescription_count }}</strong> total prescription{% if stats.prescription_count != 1 %}s{% endif %} issued
                                    <ul>
                                        <li>
                                            <!-- Display the active prescription count stats -->
                                            <strong>{{ stats.active_prescription_count }}</strong> active prescription{% if stats.activeprescription_count != 1 %}s{% endif %} issued
                                        </li>
                                    <li>
                                        <!-- Display the expired prescription count stats -->
                                        <strong>{{ stats.expired_prescription_count }}</strong> expired prescription{% if stats.expiredprescription_count != 1 %}s{% endif %} issued
                                    </li>
                                    </ul>
                                </li>
                                <li class="">
                                    <!-- Display the appointment count stats -->
                                    <strong>{{ stats.appointment_count }}</strong> appointment{% if stats.appointment_count != 1 %}s{% endif %}
                                    <ul>
                                        <li>
                                            <!-- Display the upcoming appointment count stats -->
                                            <strong>{{ stats.upcoming_appointment_count }}</strong> upcoming appointment{% if stats.upcoming_appointment_count != 1 %}s{% endif %}
                                        </li>
                                        <li>
                                            <!-- Display the past appointment count stats -->
                                            <strong>{{ stats.past_appointment_count }}</strong> past appointment{% if stats.past_appointment_count != 1 %}s{% endif %}
                                        </li>
                                    </ul>
                                </li>
                                <li class="">
                                    <strong>{{ stats.conversation_count }}</strong> conversation{% if stats.conversation_count != 1 %}s{% endif %}
                                    <ul>
                                        <li>
                                            <!-- Display the message count stats -->
                                            <strong>{{ stats.message_count }}</strong> total message{% if stats.messaget_count != 1 %}s{% endif %}
                                        </li>
                                        <li>
                                            <!-- Display the average message count stats -->
                                            Average <strong>{{ stats.average_message_count }}</strong> message{% if stats.average_message_count != 1 %}s{% endif %} per conversation
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- STATS END -->

                <!-- ACCOUNTS START -->
                <div class="col-md-6 col-sm-6">
                    <div class="x_panel">
                        <div class="x_title">
                            <!-- Display accounts for a given hospital -->
                            <h2>Accounts <small>at {{ user.hospital.name }}</small></h2>
                            <ul class="nav navbar-right panel_toolbox">
                                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                </li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <div class="dashboard-widget-content">
                                <!-- Include the url for signing up a new account -->
                                <a href="{% url 'health:signup' %}" class="btn btn-primary"><i class="fa fa-user-plus"></i>&nbsp;Add User</a>

                                <!-- Include error page incase of errors -->
                                {% include 'error.html' %}
                                <!-- If there are appointments in the future -->
                                {% if schedule_future %}
                                    <table id="datatable-responsive"
                                        class="table table-striped table-bordered dt-responsive nowrap"
                                        cellspacing="0" width="100%">
                                        <thead>
                                            <tr>
                                                <th>Account Name</th>
                                                <th>Contact</th>
                                                <th>Account Type</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Returns all current doctors -->
                                            {% for user in doctors %}
                                                <tr>
                                                    <td>
                                                        <!-- Pass thew primary key along with a link to navigate to the users informaiton -->
                                                        <a href="{% url 'health:medical_information' user.pk %}">
                                                            <!-- Display there full name -->
                                                            {{ user.get_full_name }}<br />
                                                        </a>
                                                    </td>
                                                    <!-- Display there email -->
                                                    <td>{{ user.email }}</td>
                                                    <!-- Display there group -->
                                                    <td>{{ user.group }}</td>
                                                </tr>
                                            {% endfor %}

                                            <!-- Returns all current nurses -->
                                            {% for user in nurses %}
                                                <tr>
                                                    <td>
                                                        <!-- Pass thew primary key along with a link to navigate to the users informaiton -->
                                                        <a href="{% url 'health:medical_information' user.pk %}">
                                                            <!-- Display there full name -->
                                                            {{ user.get_full_name }}<br />
                                                        </a>
                                                    </td>
                                                    <!-- Display there email -->
                                                    <td>{{ user.email }}</td>
                                                    <!-- Display there group -->
                                                    <td>{{ user.group }}</td>
                                                </tr>
                                            {% endfor %}

                                            <!-- Returns all current patients -->
                                            {% for user in patients %}
                                                <tr>
                                                    <td>
                                                        <!-- Pass thew primary key along with a link to navigate to the users informaiton -->
                                                        <a href="{% url 'health:medical_information' user.pk %}">
                                                            <!-- Display there full name -->
                                                            {{ user.get_full_name }}<br />
                                                        </a>
                                                    </td>
                                                    <!-- Display there email -->
                                                    <td>{{ user.email }}</td>
                                                    <!-- Display there group -->
                                                    <td>{{ user.group }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                {% else %}
                                    <!-- If no account exist, display it -->
                                    <h2 class="text-center">No Accounts.</h2>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ACCOUNTS END -->
            </div>
            
            <br />
            <h2 class="text-center">System Logs</h2>
            <br />
            
            <div class="x_panel">
                <div class="x_title">
                    <!-- Display the name of the hospital for the logs -->
                    <h2>Logs <small> for {{ user.hospital.name }}</small></h2>
                    <ul class="nav navbar-right panel_toolbox">
                        <li>
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>
                <div class="x_content">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="card-box table-responsive">
                                <table id="datatable-responsive"
                                    class="table table-striped table-bordered dt-responsive nowrap"
                                    cellspacing="0" width="100%">
                                    <thead>
                                        <tr>
                                            <th>Date / Time</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Log</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- For loop to iterate through all of the logs -->
                                        {% for log in logs %}
                                            <tr>
                                                <!-- Display the logged items time -->
                                                <td class="nowrap">{{ log.action_time }}</td>
                                                <td>
                                                    <!-- Rtrieve and use the priamry key for the user and full name for the user for who the log belongs -->
                                                    <a href="{% url 'health:medical_information' log.user.pk %}">{{ log.user.get_full_name }}</a>
                                                </td>
                                                <!-- Display there email -->
                                                <td class="nowrap">({{ log.user.email }})</td>
                                                <!-- Display the log -->
                                                <td class="nowrap">{{ log }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            <!-- End of admin section -->
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <footer>
            <div class="pull-right">
                Created by <a href="http://www.neville-bulmer.com/">Neville Bulmer</a> with the help of bootstrap
            </div>
            <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
    </div>
</div>

<!-- Model code for sending a new message -->
<div class="modal fade" id="send" tabindex="-1" role="dialog" aria-labelledby="send" aria-hidden="true"  data-backdrop="false">
    <div class="modal-dialog">
        <form action="{% url 'health:add_group' %}" method="post" accept-charset="utf-8" class="form" role="form">
            <!-- Generate a token for the form -->
            {% csrf_token %}
            <div class="modal-content">
                <div class="modal-header">
                    Send Message
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <label for="name">Conversation Name</label>
                                <input id="name" type="text" class="form-control" name="name" placeholder="Discussion about Test Results">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="recipient">Recipient</label>
                                <select multiple="multiple" id="recipient" name="recipient" class='form-control'>
                                    <!-- For loop for iterating through all users -->
                                    {% for user in recipients %}
                                        <!-- Return the users full name and primary key -->
                                        <option name="recipient" value="{{ user.pk }}">{{ user.get_full_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <label for="message">Message</label>
                                <textarea class='form-control' name="message" placeholder="Dear Doctor, I have a question..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" data-dismiss="send" class="btn btn-default" onclick="close_modal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary close-modal">
                        Send
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    $('#recipient').multiselect();

    function close_modal() {
        $('#send').modal('hide');
    }
</script>

{% endblock %}